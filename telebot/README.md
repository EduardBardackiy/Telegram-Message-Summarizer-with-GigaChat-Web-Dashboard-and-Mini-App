# Telegram Bot для саммаризации

Бот работает по команде — получает все новые сообщения из БД, создаёт выжимку через GigaChat и отправляет результат.

## Как запустить

1. Убедитесь что заданы переменные в `.env`:
   ```
   BOT_TOKEN=your_bot_token
   GIGACHAT_CLIENT_ID=...
   GIGACHAT_CLIENT_SECRET=...
   ```

2. Активируйте виртуальное окружение:
   ```powershell
   .\.venv\Scripts\Activate.ps1
   ```

3. Запустите бота:
   ```bash
   python telebot\summary_bot.py
   ```

## Команды бота

- `/start` или `/help` — показать список команд
- `/status` — показать количество необработанных сообщений в БД
- `/summary` — создать саммаризацию всех новых сообщений

## Как это работает

1. **Telethon** (`telethon/main.py`) слушает сообщения в Telegram и сохраняет их в БД (`messages.db`)
2. **Summary Bot** ждёт команду `/summary` от пользователя
3. По команде бот:
   - Читает все сообщения с `summarized=0`
   - Объединяет их тексты
   - Отправляет в GigaChat для саммаризации
   - Отправляет результат пользователю
   - Помечает сообщения как обработанные (`summarized=1`)

## База данных

- `messages.db` — SQLite база с таблицей `messages`
- Колонки: `id`, `chat_id`, `sender`, `text`, `date`, `summarized`
- `summarized=0` — новое сообщение, требует обработки
- `summarized=1` — сообщение обработано

## Логирование

Бот логирует:
- Запросы на саммаризацию
- Количество обрабатываемых сообщений
- Ошибки GigaChat API
- Результаты обработки
